# Service Manager Tool

这是一个基于 Windows 的轻量级服务管理工具，支持通过图形界面（GUI）管理本地服务（Python 脚本、批处理文件、可执行程序），并支持将其注册为 Windows 系统服务以实现开机自启和后台运行。

## 功能特性

*   **多类型支持**：支持管理 Python 脚本、Batch 批处理文件 (.bat) 和普通可执行文件 (.exe)。
*   **图形化管理**：提供直观的 GUI 界面，用于添加、编辑、删除、启动和停止服务。
*   **实时状态监控**：显示服务的运行状态、PID、占用端口、类型、自启动状态、控制台显示状态、自动重启状态和运行时间。
    *   **端口检测**：自动检测服务及其子进程占用的 TCP/UDP 端口。
*   **自动守护**：支持服务异常退出自动重启。
    *   **重启策略**：进程非正常退出后，间隔 1 秒自动重启。
    *   **故障保护**：若 1 分钟内同一程序重启超过 3 次仍然退出，则停止该服务，防止无限重启。
*   **操作日志**：窗口下部实时显示服务启动、停止、重启及异常退出的操作日志。
*   **界面优化**：
    *   **分栏布局**：窗口分为上下两部分，上部为程序清单（支持显示 10 行），下部为操作日志区域。
    *   **选项卡配置**：服务配置分为“常规”和“选项”两个标签页，分类更清晰。
    *   **视觉改进**：程序清单背景统一为白色，字体为黑色；隐藏 C++ 控制台窗口；使用专用程序图标。
*   **控制台管理**：支持隐藏服务的控制台窗口，让服务在后台静默运行。
*   **日志查看**：支持查看每个服务的标准输出和错误日志。
*   **完整的中文支持**：
    *   **中文路径**：完全支持程序安装在包含中文的路径下。
    *   **中文服务名**：支持中文服务名称，日志和PID文件名正确显示。
    *   **Unicode编码**：所有文件操作使用Unicode，确保跨语言兼容性。
*   **系统服务集成**：
    *   **注册服务**：一键将本工具注册为 Windows 系统服务，实现开机自动启动。
    *   **后台运行**：注册为系统服务后，勾选"自动启动"的子服务将在后台静默运行。
    *   **配置同步**：在 GUI 中修改配置后，后台系统服务会自动感知并应用更改（如启动新的自启服务）。
    *   **智能关闭**：
        *   若系统服务正在运行，关闭 GUI **不会**停止后台服务。
        *   若仅以普通模式运行（未注册系统服务），关闭 GUI 会自动停止所有子服务。
*   **托盘运行**：支持最小化到系统托盘，保持整洁。
*   **智能任务栏交互**：点击任务栏图标时，窗口会切换到最前台而不是最小化，提升使用体验。

## 使用说明

### 1. 运行程序
双击 `service_manager.exe` 启动程序。

### 2. 管理服务
*   **添加/编辑服务**：
    *   **常规**：填写服务名称、类型、脚本路径、工作目录等基本信息。
    *   **选项**：
        *   **自动启动**：勾选此项，服务将在程序启动（或系统服务启动）时自动运行。
        *   **隐藏控制台**：勾选此项，服务运行时不会显示控制台窗口。
        *   **自动重启**：勾选此项，服务异常退出时将自动尝试重启。
*   **编辑/删除**：右键点击列表中的服务，或选中后点击底部按钮进行操作。
*   **启动/停止**：在列表中右键点击服务进行控制，或使用底部按钮批量操作。
*   **最小化到托盘**：点击底部 "到托盘" 按钮，程序将隐藏并最小化到系统托盘，保持后台运行。

### 3. 查看日志
*   **操作日志**：窗口下部实时记录并显示所有服务的启动、停止、重启及异常中断等操作信息。
*   **运行日志**：右键点击服务列表中的某一项，选择 **"查看日志"** 即可查看该服务的标准输出和错误日志文件。

### 4. 系统服务模式（推荐）
若需要服务开机自启且在后台长期运行：
1.  在 GUI 底部点击 **"系统服务"** 按钮，选择 **"注册并启动系统服务"**（需要管理员权限）。
2.  成功后，Windows 服务列表中会出现名为 `Service Manager Tool` 的服务。
3.  **注意**：系统服务模式下，子服务在后台运行，无可见窗口。您仍可打开 GUI 查看状态和管理配置。

## 编译指南

本项目使用 C++ 编写，依赖 Windows API 和 Common Controls 库。

### 环境要求
*   MinGW-w64 (g++) 或其他支持 C++11 的 Windows 编译器。
*   Windows SDK (通常随编译器或系统提供)。

### 编译命令
在项目根目录下运行以下命令：

```bash
# 1. 编译资源文件 (图标等)
windres resource.rc -o resource.o

# 2. 编译主程序
g++ service_manager.cpp resource.o -o service_manager.exe -mwindows -static -lcomctl32 -lws2_32 -liphlpapi -ldwmapi -luxtheme -lmsimg32 -lole32 -lshlwapi
```

## 配置文件
*   **服务配置**：存储在 `services_config.ini` 文件中。
    *   `startup_interval`：程序启动间隔时间（毫秒），默认为 1000ms。
*   **运行状态**：PID 存储在 `pids` 文件夹中，文件名格式为 `<服务名>.pid`。
*   **日志文件**：存储在 `logs` 文件夹中，文件名格式为 `<服务名>.log`。

## 注意事项
*   **中文支持**：程序完全支持中文路径和中文服务名，所有文件操作使用Unicode编码。
*   **路径支持**：程序支持相对路径和绝对路径。相对路径会相对于程序所在目录进行解析。
*   **Python 环境**：如果是 Python 服务，建议指定明确的 Python 解释器路径，或者确保全局 `python` 命令可用。
*   **权限**：注册和注销系统服务需要管理员权限。
*   **自动重启**：手动结束进程（如使用 taskkill）也会触发自动重启（如果启用了该功能）。

## 作者
项目地址：[https://github.com/git-howard](https://github.com/git-howard)
